# Performance Optimization: Parallel Post Generation

## –û–≥–ª—è–¥

–°–∏—Å—Ç–µ–º–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î **–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–µ –ø—Ä–æ–≥—Ä–∞–º—É–≤–∞–Ω–Ω—è** —Ç–∞ **–ø–∞—Ä–∞–ª–µ–ª—å–Ω–µ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è** –¥–ª—è –∑–Ω–∞—á–Ω–æ–≥–æ –ø—Ä–∏—Å–∫–æ—Ä–µ–Ω–Ω—è –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó –∫–æ–Ω—Ç–µ–Ω—Ç—É.

## –ü—Ä–æ–±–ª–µ–º–∞ –°—Ç–∞—Ä–æ–≥–æ –ü—ñ–¥—Ö–æ–¥—É

### –ü–æ—Å–ª—ñ–¥–æ–≤–Ω–µ –í–∏–∫–æ–Ω–∞–Ω–Ω—è (Sync)
```
–ß–∞—Å –≤–∏–∫–æ–Ω–∞–Ω–Ω—è = –ß–∞—Å(–ë—Ä–∏—Ñ) + N √ó –ß–∞—Å(–ü–æ—Å—Ç)
```

–î–µ:
- `–ß–∞—Å(–ë—Ä–∏—Ñ)` ‚âà 3-5 —Å–µ–∫—É–Ω–¥
- `–ß–∞—Å(–ü–æ—Å—Ç)` ‚âà 3-4 —Å–µ–∫—É–Ω–¥–∏
- `N` = –∫—ñ–ª—å–∫—ñ—Å—Ç—å –ø–æ—Å—Ç—ñ–≤ (3-5)

**–ó–∞–≥–∞–ª—å–Ω–∏–π —á–∞—Å –¥–ª—è 5 –ø–æ—Å—Ç—ñ–≤:**
```
3s (–ë—Ä–∏—Ñ) + 5 √ó 4s = 23 —Å–µ–∫—É–Ω–¥–∏
```

## –†—ñ—à–µ–Ω–Ω—è: –ü–∞—Ä–∞–ª–µ–ª—å–Ω–µ –í–∏–∫–æ–Ω–∞–Ω–Ω—è

### –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–µ –í–∏–∫–æ–Ω–∞–Ω–Ω—è (Async)
```
–ù–æ–≤–∏–π —á–∞—Å = –ß–∞—Å(–ë—Ä–∏—Ñ) + MAX(–ß–∞—Å(–ü–æ—Å—Ç‚ÇÅ), –ß–∞—Å(–ü–æ—Å—Ç‚ÇÇ), ...)
```

**–ó–∞–≥–∞–ª—å–Ω–∏–π —á–∞—Å –¥–ª—è 5 –ø–æ—Å—Ç—ñ–≤:**
```
3s (–ë—Ä–∏—Ñ) + MAX(4s, 4s, 4s, 4s, 4s) = 7 —Å–µ–∫—É–Ω–¥
```

**–ü—Ä–∏—Å–∫–æ—Ä–µ–Ω–Ω—è: 3-4x —à–≤–∏–¥—à–µ! üöÄ**

## –¢–µ—Ö–Ω—ñ—á–Ω–∞ –†–µ–∞–ª—ñ–∑–∞—Ü—ñ—è

### 1. –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞ –§—É–Ω–∫—Ü—ñ—è –ì–µ–Ω–µ—Ä–∞—Ü—ñ—ó –ü–æ—Å—Ç—É

```python
async def generate_single_post_async(
    topic: object,
    input_data: CampaignInput,
    config_post: object,
    MODEL_NAME: str
) -> PostOutput:
    """Asynchronously generate a single post"""
    # ... logic –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó –æ–¥–Ω–æ–≥–æ –ø–æ—Å—Ç—É
```

### 2. –ü–∞—Ä–∞–ª–µ–ª—å–Ω–µ –í–∏–∫–æ–Ω–∞–Ω–Ω—è —á–µ—Ä–µ–∑ `asyncio.gather()`

```python
# –°—Ç–≤–æ—Ä—é—î–º–æ —Å–ø–∏—Å–æ–∫ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∏—Ö –∑–∞–¥–∞—á
async_tasks = [
    generate_single_post_async(topic, input_data, config_post, MODEL_NAME)
    for topic in brief.post_topics
]

# –í–∏–∫–æ–Ω—É—î–º–æ –≤—Å—ñ –∑–∞–¥–∞—á—ñ –û–î–ù–û–ß–ê–°–ù–û
final_posts = await asyncio.gather(*async_tasks)
```

### 3. –û–±–≥–æ—Ä—Ç–∫–∞ –°–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–≥–æ Gemini API

```python
# –û–±–≥–æ—Ä—Ç–∞—î–º–æ —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∏–π –≤–∏–∫–ª–∏–∫ Gemini API
response_post = await asyncio.to_thread(
    client.models.generate_content,
    model=MODEL_NAME,
    contents=[prompt_adapter],
    config=config_post,
)
```

## –ü–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è –ß–∞—Å—ñ–≤

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ü–æ—Å–ª—ñ–¥–æ–≤–Ω–æ | –ü–∞—Ä–∞–ª–µ–ª—å–Ω–æ | –ü–æ–∫—Ä–∞—â–µ–Ω–Ω—è |
|----------|-----------|------------|-----------|
| 3 –ø–æ—Å—Ç–∏  | 15 —Å–µ–∫    | 7 —Å–µ–∫      | **2.1x**  |
| 4 –ø–æ—Å—Ç–∏  | 19 —Å–µ–∫    | 7 —Å–µ–∫      | **2.7x**  |
| 5 –ø–æ—Å—Ç—ñ–≤ | 23 —Å–µ–∫    | 7 —Å–µ–∫      | **3.3x**  |

## –ü–µ—Ä–µ–≤–∞–≥–∏

‚úÖ **–®–≤–∏–¥–∫—ñ—Å—Ç—å**: –ì–µ–Ω–µ—Ä–∞—Ü—ñ—è –≤ 3-4 —Ä–∞–∑–∏ —à–≤–∏–¥—à–∞  
‚úÖ **–ú–∞—Å—à—Ç–∞–±–æ–≤–∞–Ω—ñ—Å—Ç—å**: –î–æ–¥–∞–≤–∞–Ω–Ω—è –ø–æ—Å—Ç—ñ–≤ –Ω–µ –ª—ñ–Ω—ñ–π–Ω–æ –∑–±—ñ–ª—å—à—É—î —á–∞—Å  
‚úÖ **–†–µ—Å—É—Ä—Å–∏**: –ï—Ñ–µ–∫—Ç–∏–≤–Ω–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è I/O –æ—á—ñ–∫—É–≤–∞–Ω–Ω—è  
‚úÖ **UX**: –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –æ—Ç—Ä–∏–º—É—î —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∑–∞ 5-8 —Å–µ–∫—É–Ω–¥ –∑–∞–º—ñ—Å—Ç—å 15-25

## –¢–µ—Ö–Ω—ñ—á–Ω—ñ –î–µ—Ç–∞–ª—ñ

### –ß–æ–º—É –¶–µ –ü—Ä–∞—Ü—é—î

1. **I/O Bound –æ–ø–µ—Ä–∞—Ü—ñ—ó**: –í–∏–∫–ª–∏–∫–∏ API —î –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∏–º–∏
2. **FastAPI**: –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∏–π —Ñ—Ä–µ–π–º–≤–æ—Ä–∫ –ø—ñ–¥—Ç—Ä–∏–º—É—î `async/await`
3. **Gemini API**: –ü—ñ–¥—Ç—Ä–∏–º—É—î –ø–∞—Ä–∞–ª–µ–ª—å–Ω—ñ –∑–∞–ø–∏—Ç–∏
4. **Thread Pool**: `asyncio.to_thread()` –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î –ø–æ—Ç–æ–∫–∏ –¥–ª—è CPU-intensive –∑–∞–≤–¥–∞–Ω—å

### –û–±–º–µ–∂–µ–Ω–Ω—è

‚ö†Ô∏è **Rate Limiting**: –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –ª—ñ–º—ñ—Ç–∏ Gemini API  
‚ö†Ô∏è **Memory**: –ü–∞—Ä–∞–ª–µ–ª—å–Ω—ñ –∑–∞–ø–∏—Ç–∏ —Å–ø–æ–∂–∏–≤–∞—é—Ç—å –±—ñ–ª—å—à–µ –ø–∞–º'—è—Ç—ñ  
‚ö†Ô∏è **Network**: –ó–±—ñ–ª—å—à–µ–Ω–Ω—è –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –Ω–∞ –º–µ—Ä–µ–∂—É

## –ú–∞–π–±—É—Ç–Ω—ñ –û–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—ó

1. **Batch Processing**: –û–±'—î–¥–Ω–∞–Ω–Ω—è –∑–∞–ø–∏—Ç—ñ–≤ –¥–ª—è —â–µ –∫—Ä–∞—â–æ—ó –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ
2. **Caching**: –ö–µ—à—É–≤–∞–Ω–Ω—è —á–∞—Å—Ç–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞–Ω–∏—Ö –ø—Ä–æ–º–ø—Ç—ñ–≤
3. **WebSocket**: Real-time –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –ø—Ä–æ–≥—Ä–µ—Å—É –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó
4. **Streaming**: –ü–æ—Å–ª—ñ–¥–æ–≤–Ω–∏–π –≤–∏–≤—ñ–¥ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ –±–µ–∑ –æ—á—ñ–∫—É–≤–∞–Ω–Ω—è –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è –≤—Å—ñ—Ö

## –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥

–î–ª—è –≤—ñ–¥—Å—Ç–µ–∂–µ–Ω–Ω—è –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ –¥–∏–≤—ñ—Ç—å—Å—è –≤ –ª–æ–≥–∏:

```
üöÄ Starting parallel generation of 5 posts...
‚úÖ Completed parallel generation of 5 posts!
```

–ß–∞—Å –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó –∫–æ–∂–Ω–æ–≥–æ –ø–æ—Å—Ç—É –≤–∏–≤–æ–¥–∏—Ç—å—Å—è –æ–∫—Ä–µ–º–æ –¥–ª—è –∞–Ω–∞–ª—ñ–∑—É.
